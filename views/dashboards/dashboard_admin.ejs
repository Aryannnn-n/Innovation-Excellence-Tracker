<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <style></style>

  <body class="bg-gradient-to-r from-orange-100 to-orange-400 min-h-screen p-6">
    <!-- Floating Navbar -->
    <nav
      class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-orange-500 text-white w-[100%] max-w-5xl py-3 px-6 shadow-lg rounded-xl flex justify-between items-center"
    >
      <h1 class="nav-title text-xl font-bold">Admin Dashboard</h1>
      <div>
        <!-- <span class="font-semibold"> <%= user.name %> </span> -->
        <!-- Logout Button -->
        <a
          href="/user/logout"
          class="relative group ml-4 px-4 py-2 rounded-lg transition"
        >
          <i class="fa-solid fa-right-from-bracket text-xl"></i>
          <!-- Hover Label -->
          <span
            class="absolute left-1/2 transform -translate-x-1/2 bottom-[-30px] bg-orange-200 text-black font-bold text-sm px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity"
          >
            Logout
          </span>
        </a>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-5xl mx-auto p-6 bg-white shadow-lg rounded-lg mt-20">
      <h2 class="text-2xl font-bold text-orange-600">
        Welcome, <%= user.name %>
      </h2>

      <h3 class="text-xl font-semibold mt-6">All Submitted Innovations</h3>

      <table class="w-full mt-4 border border-gray-300 rounded-lg">
        <thead class="bg-orange-300">
          <tr>
            <th class="border border-gray-300 p-2">Title</th>
            <th class="border border-gray-300 p-2">Submitted By</th>
            <th class="border border-gray-300 p-2">Category</th>
            <th class="border border-gray-300 p-2">Status</th>
            <th class="border border-gray-300 p-2">Proposal</th>
            <th class="border border-gray-300 p-2">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (innovations.length> 0) { %> <%
          innovations.forEach(function(innovation) { %>
          <tr class="text-center even:bg-orange-50 odd:bg-white">
            <td class="border border-gray-300 p-2"><%= innovation.title %></td>
            <td class="border border-gray-300 p-2">
              <%= innovation.studentName %>
            </td>
            <td class="border border-gray-300 p-2">
              <%= innovation.category %>
            </td>

            <!-- Status Column with Colored Labels -->
            <td class="border border-gray-300 p-2 text-center">
              <% if (innovation.status==='approved' ) { %>
              <span
                class="relative group text-green-500 px-2 py-1 rounded cursor-pointer"
              >
                <i class="fa-solid fa-circle-check"></i>
                <!-- Tooltip -->
                <span
                  class="absolute left-1/2 -translate-x-1/2 bottom-full mb-1 hidden group-hover:flex bg-gray-900 text-white text-xs px-2 py-1 rounded shadow-md whitespace-nowrap"
                >
                  Approved
                </span>
              </span>

              <% } else if (innovation.status==='rejected' ) { %>
              <span class="bg-red-500 text-white px-2 py-1 rounded"
                >Rejected</span
              >
              <% } else { %>
              <span class="bg-yellow-500 text-white px-2 py-1 rounded"
                >Pending</span
              >
              <% } %>
            </td>

            <!-- Proposal File View Button -->
            <td class="border border-gray-300 p-2 text-center">
              <% if (innovation.proposalFile) { %>
              <a
                href="/uploads/<%= innovation.proposalFile %>"
                target="_blank"
                class="relative group text-blue-500 px-3 py-1 rounded transition"
              >
                <i class="fa-brands font-bold fa-wpforms"></i>

                <!-- Tooltip -->
                <span
                  class="absolute left-1/2 -translate-x-1/2 bottom-full mb-1 hidden group-hover:flex bg-gray-900 text-white text-xs px-2 py-1 rounded shadow-md whitespace-nowrap"
                >
                  View Report
                </span>
              </a>

              <% } else { %>
              <span class="text-gray-500">No file</span>
              <% } %>
            </td>

            <!-- Edit & Delete Buttons -->
            <td class="border border-gray-300 p-2 flex gap-2 justify-center">
              <form
                action="/admin/delete-innovation/<%= innovation._id %>"
                method="POST"
              >
                <button
                  type="submit"
                  class="relative group px-3 py-1 text-red-500 rounded-lg hover:text-red-600 transition"
                >
                  <i class="fa-solid fa-eraser"></i>

                  <!-- Tooltip -->
                  <span
                    class="absolute left-1/2 -translate-x-1/2 bottom-full mb-1 hidden group-hover:flex bg-gray-900 text-white text-xs px-2 py-1 rounded shadow-md whitespace-nowrap"
                  >
                    Delete Submission
                  </span>
                </button>
              </form>
            </td>
          </tr>
          <% }); %> <% } else { %>
          <tr>
            <td
              colspan="5"
              class="border border-gray-300 p-4 text-center text-gray-500"
            >
              No innovations submitted yet.
            </td>
          </tr>
          <% } %>
        </tbody>
      </table>

      <!-- Admin Opportunity Posting Section -->
      <!-- All Hackthons -->
      <div class="max-w-5xl mx-auto p-6 bg-orange-100 shadow-lg rounded-lg mt-10">
        <h2 class="text-2xl font-bold text-orange-600">Post a New Events</h2>

        <form action="/admin/post-hackathon" method="POST" class="mt-4">
          <label class="block text-gray-700 font-semibold">Title:</label>
          <input
            type="text"
            name="title"
            class="w-full p-2 border rounded-lg mt-1"
            required
          />

          <label class="block text-gray-700 font-semibold mt-2">Date:</label>
          <input
            type="date"
            name="date"
            class="w-full p-2 border rounded-lg mt-1"
            required
          />

          <label class="block text-gray-700 font-semibold mt-2"
            >Description:</label
          >
          <textarea
            name="description"
            class="w-full p-2 border rounded-lg mt-1"
            required
          ></textarea>

          <label class="block text-gray-700 font-semibold mt-2"
            >Registration Link:</label
          >
          <input
            type="url"
            name="registrationLink"
            class="w-full p-2 border rounded-lg mt-1"
            required
          />

          <button
            type="submit"
            class="mt-4 bg-yellow-400 font-bold text-black px-6 py-2 rounded-lg hover:bg-yellow-500 transition"
          >
            Send News
          </button>
        </form>
      </div>

      <!-- Hackathon Listings -->
      <div class="max-w-5xl mx-auto p-6 bg-white shadow-lg rounded-lg mt-10">
        <h2 class="text-2xl font-bold text-orange-600">Uploaded Events News</h2>

        <table class="w-full mt-4 border-collapse border border-gray-300">
          <thead>
            <tr class="bg-yellow-200">
              <th class="border border-gray-300 p-2">Title</th>
              <th class="border border-gray-300 p-2">Date</th>
              <th class="border border-gray-300 p-2">Description</th>
              <th class="border border-gray-300 p-2">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (hackathons.length> 0) { %> <% hackathons.forEach(hackathon=>
            { %>
            <tr class="border border-gray-300 bg-yellow-50">
              <td class="border border-gray-300 p-2"><%= hackathon.title %></td>
              <td class="border border-gray-300 p-2">
                <%= hackathon.date ? hackathon.date.toISOString().slice(0, 10) :
                "N/A" %>
              </td>
              <td class="border border-gray-300 p-2">
                <%= hackathon.description %>
              </td>
              <td class="border border-gray-300 p-2 text-center">
                <form
                  action="/admin/delete-hackathon/<%= hackathon._id %>"
                  method="POST"
                >
                  <button
                    type="submit"
                    class="px-3 py-1 text-zinc-600 text-white rounded-lg hover:text-red-600 transition"
                  >
                    <i class="fa-solid fa-trash-can"></i>
                  </button>
                </form>
              </td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="4" class="text-center p-4">
                No hackathons available
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
    <div
      class="max-w-5xl mx-auto p-6 flex flex-wrap mx-auto p-6 bg-white shadow-lg rounded-lg mt-2"
    >
      <h2 class="text-2xl text-orange-600 font-bold mt-6">Here's Analysis</h2>
      <div class="w-full flex justify-center items-center mt-6">
        <div class="w-full max-w-4xl bg-orange-100 p-6 rounded-lg shadow-md flex flex-col items-center">
          <div class="w-2/3 mb-6 text-center">
        <h3 class="text-lg font-semibold mb-2">Participants Chart</h3>
        <canvas id="parcipantChart"></canvas>
          </div>
          <div class="w-2/3 text-center">
        <h3 class="text-lg font-semibold mb-2">Department Chart</h3>
        <canvas id="departmentChart"></canvas>
          </div>
        </div>
      </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script src="/graphs/adminDashboard.js"></script>
    </div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"
      integrity="sha512-7eHRwcbYkK4d9g/6tD/mhkf++eoTHwpNM9woBxtPUBWm67zeAfFC+HrdoE2GanKeocly/VxeLvIqwvCdk7qScg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      function breakText() {
        var h1 = document.querySelector(".nav-title");
        var h1Text = h1.textContent;

        var splittedText = h1Text.split("");

        var clutter = "";

        splittedText.forEach((e) => {
          clutter += `<span>${e}</span>`; //each element would be in a span tag
        });

        h1.innerHTML = clutter;
      }
      breakText();

      gsap.from("h1 span", {
        y: 70,
        opacity: 0,
        duration: 0.5,
        delay: 0.5,
        stagger: 0.15,
        ease: "power2.out",
      });
    </script>
  </body>
</html>
